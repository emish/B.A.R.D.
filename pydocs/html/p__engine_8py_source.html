<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BARD: /home/erikay/bard/dev/persistence_engine/source/p_engine.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="header">
  <div class="headertitle">
<h1>/home/erikay/bard/dev/persistence_engine/source/p_engine.py</h1>  </div>
</div>
<div class="contents">
<a href="p__engine_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacep__engine.html">00001</a> <span class="comment">#!/usr/bin/python # p_engine.py</span>
<a name="l00002"></a>00002 <span class="keyword">import</span> parser
<a name="l00003"></a>00003 <span class="comment">#import test_parser</span>
<a name="l00004"></a>00004 <span class="comment">## @class Pengine</span>
<a name="l00005"></a>00005 <span class="comment">#  @author The Bard Team</span>
<a name="l00006"></a>00006 <span class="comment">#  @version 1.1</span>
<a name="l00007"></a><a class="code" href="classp__engine_1_1Pengine.html">00007</a> <span class="keyword">class </span><a class="code" href="classp__engine_1_1Pengine.html">Pengine</a>:
<a name="l00008"></a>00008 
<a name="l00009"></a><a class="code" href="classp__engine_1_1Pengine.html#a985b3bafa3b7eee0acb8fa4ac874b1bd">00009</a>     window_size = 10000 <span class="comment">#must be in ddhhmmss form</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011     <span class="comment">## A new Pengine object is initialized by the Bard module to track atoms and their persistence.</span>
<a name="l00012"></a>00012     <span class="comment">#  @param self</span>
<a name="l00013"></a>00013     <span class="comment">#  @param frame_sizes tuple of frame sizes</span>
<a name="l00014"></a>00014     <span class="comment">#  @param max_atoms the maximum number of atoms Pengine will track for persistence</span>
<a name="l00015"></a>00015     <span class="comment">#  @param path The path where the Snort binary dumps can be found</span>
<a name="l00016"></a>00016     <span class="comment">#  @param p_star The threshold ratio for significant atom persistence within a frame</span>
<a name="l00017"></a><a class="code" href="classp__engine_1_1Pengine.html#a71ed14eb65b5fb448e9289cc9ad86cb7">00017</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#afbe4a4b62e1a67b032a5852b47a744d8" title="A new Pengine object is initialized by the Bard module to track atoms and their persistence.">__init__</a>(self, frame_sizes, max_atoms, path, p_star):
<a name="l00018"></a>00018         self.<a class="code" href="classp__engine_1_1Pengine.html#ae4f9218807b24d4e2afb3122dab4b981">t_0</a> = 0
<a name="l00019"></a>00019         self.<a class="code" href="classp__engine_1_1Pengine.html#a71ed14eb65b5fb448e9289cc9ad86cb7">t_1</a> = Pengine.window_size
<a name="l00020"></a>00020         self.<a class="code" href="classp__engine_1_1Pengine.html#ad1f1d6652c5302615212355d55ab7797">max_frame_size</a> = max(frame_sizes)
<a name="l00021"></a>00021         self.<a class="code" href="classp__engine_1_1Pengine.html#a58b56e48011a894ec0fdb49bf4041f98">frame_sizes</a> = frame_sizes
<a name="l00022"></a>00022         self.<a class="code" href="classp__engine_1_1Pengine.html#a9d73408ab4c3b00739ea61f69ae828cf">atom_list</a> = []
<a name="l00023"></a>00023         self.<a class="code" href="classp__engine_1_1Pengine.html#a01e3a242f2a577a907b9b3c42684ee9f">persistent_list</a> = []
<a name="l00024"></a>00024         self.<a class="code" href="classp__engine_1_1Pengine.html#a4166dc5955cdfc2bdda64cd5937401a7">bitmaps</a> = {}
<a name="l00025"></a>00025         self.<a class="code" href="classp__engine_1_1Pengine.html#aa534599861376f871c1e608720d925a9">id_list</a> = []
<a name="l00026"></a>00026         self.<a class="code" href="classp__engine_1_1Pengine.html#a73a2bd7bd6c4098929c734df639dd4a2">max_ids</a> = max_atoms
<a name="l00027"></a>00027         self.<a class="code" href="classp__engine_1_1Pengine.html#a08efa7e34e28a632288d5002758b79be">parser</a> = parser.parser(path)
<a name="l00028"></a>00028         <span class="comment">#self.parser = test_parser.test_parser(path)</span>
<a name="l00029"></a>00029         self.<a class="code" href="classp__engine_1_1Pengine.html#a39eda9d895a243ded1cf39285a6e916b">p_star</a> = p_star
<a name="l00030"></a>00030 
<a name="l00031"></a>00031     <span class="comment">## @class Atom</span>
<a name="l00032"></a>00032     <span class="comment">#  @author The Bard Team</span>
<a name="l00033"></a>00033     <span class="comment">#  @version 1.1</span>
<a name="l00034"></a><a class="code" href="classp__engine_1_1Pengine_1_1Atom.html">00034</a>     <span class="keyword">class </span><a class="code" href="classp__engine_1_1Pengine_1_1Atom.html">Atom</a>:
<a name="l00035"></a>00035         <span class="comment">## Initialize a new atom object with defaul ID -1 that may or may not</span>
<a name="l00036"></a>00036         <span class="comment">#  added to existing Bard data structures</span>
<a name="l00037"></a>00037         <span class="comment">#  @param ip The destination ip</span>
<a name="l00038"></a>00038         <span class="comment">#  @param port The destination port</span>
<a name="l00039"></a>00039         <span class="comment">#  @param protocol The protocol of the packet</span>
<a name="l00040"></a>00040         <span class="comment">#  @param timestamp When the packet was received</span>
<a name="l00041"></a><a class="code" href="classp__engine_1_1Pengine_1_1Atom.html#aff46c295e16184fb88044505564a8bfd">00041</a>         <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine_1_1Atom.html#a8e43042991ee2533672279cd193997c7" title="Initialize a new atom object with defaul ID -1 that may or may not added to existing Bard data struct...">__init__</a>(self, ip, port, protocol, timestamp):
<a name="l00042"></a>00042 
<a name="l00043"></a>00043             self.<a class="code" href="classp__engine_1_1Pengine_1_1Atom.html#a5d52ba5d5605285363fad1727ed5f7b4">id</a> = -1;
<a name="l00044"></a>00044             self.<a class="code" href="classp__engine_1_1Pengine_1_1Atom.html#a2a3297875a21ebed73272f3cafa37e39">dest_ip</a> = ip
<a name="l00045"></a>00045             self.<a class="code" href="classp__engine_1_1Pengine_1_1Atom.html#ad08342122e292a70c389831c6f268e89">dest_port</a> = port
<a name="l00046"></a>00046             self.<a class="code" href="classp__engine_1_1Pengine_1_1Atom.html#aff46c295e16184fb88044505564a8bfd">protocol</a> = protocol
<a name="l00047"></a>00047             self.<a class="code" href="classp__engine_1_1Pengine_1_1Atom.html#aa139b2bb1c4f6d80380ea1419b3f5c91">last_timestamp</a> = timestamp
<a name="l00048"></a>00048     
<a name="l00049"></a>00049     <span class="comment">## The method called by the Bard module to process a file of Snort output into atom data</span>
<a name="l00050"></a>00050     <span class="comment">#  @param self</span>
<a name="l00051"></a>00051     <span class="comment">#  @returns List of persistent atoms found in this batch/file of Snort output</span>
<a name="l00052"></a><a class="code" href="classp__engine_1_1Pengine.html#a2b50a34694e5a56a84652d1a1d084e62">00052</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#a2b50a34694e5a56a84652d1a1d084e62" title="The method called by the Bard module to process a file of Snort output into atom data.">run</a>(self):
<a name="l00053"></a>00053 
<a name="l00054"></a>00054         self.<a class="code" href="classp__engine_1_1Pengine.html#a01e3a242f2a577a907b9b3c42684ee9f">persistent_list</a> = []
<a name="l00055"></a>00055 
<a name="l00056"></a>00056         a = self.<a class="code" href="classp__engine_1_1Pengine.html#ac27626387a7c90d1bc407e28eceac7d3" title="Translates the atom tuple received from Parser.py into an Atom object.">getAtomObject</a>()
<a name="l00057"></a>00057         counter = 0
<a name="l00058"></a>00058         <span class="keywordflow">while</span>(a == <span class="keywordtype">None</span>):
<a name="l00059"></a>00059             a = self.<a class="code" href="classp__engine_1_1Pengine.html#ac27626387a7c90d1bc407e28eceac7d3" title="Translates the atom tuple received from Parser.py into an Atom object.">getAtomObject</a>()
<a name="l00060"></a>00060         <span class="keywordflow">while</span>(a.last_timestamp != <span class="stringliteral">&quot;EOF&quot;</span>):
<a name="l00061"></a>00061             <span class="keywordflow">while</span> self.<a class="code" href="classp__engine_1_1Pengine.html#ae4154c89c64df490a1a527c70500b83d" title="Updates local time-keeping variables based on latest atom timestamp.">timeCheck</a>(a) == 1:
<a name="l00062"></a>00062                 self.<a class="code" href="classp__engine_1_1Pengine.html#aae30c615b50a50d2b4575c8e3bd1c307" title="Removes all windows no longer in frame and adds new windows for latest part of frame.">cleanBitmap</a>()
<a name="l00063"></a>00063             
<a name="l00064"></a>00064             self.<a class="code" href="classp__engine_1_1Pengine.html#a501fb9bba5a38eb9eed3d2c66d3e1a8d" title="Adds a premade atom to the atom_list.">addAtom</a>(a)
<a name="l00065"></a>00065             <span class="comment">#now the atom must exist</span>
<a name="l00066"></a>00066             self.<a class="code" href="classp__engine_1_1Pengine.html#a2533c9acb91e279ca639b0791b43e060" title="Updates the atom&amp;#39;s bitmap to reflect a sighting during the current window.">updateBitmap</a>(self.<a class="code" href="classp__engine_1_1Pengine.html#a794d77f201d3404d5c4d8d9eabf34fed" title="Determines whether the current atom already exists in bard&amp;#39;s data structures and if it does it up...">atomExists</a>(a))
<a name="l00067"></a>00067             
<a name="l00068"></a>00068             a = self.<a class="code" href="classp__engine_1_1Pengine.html#ac27626387a7c90d1bc407e28eceac7d3" title="Translates the atom tuple received from Parser.py into an Atom object.">getAtomObject</a>()
<a name="l00069"></a>00069             <span class="keywordflow">while</span>(a == <span class="keywordtype">None</span>):
<a name="l00070"></a>00070                a = self.<a class="code" href="classp__engine_1_1Pengine.html#ac27626387a7c90d1bc407e28eceac7d3" title="Translates the atom tuple received from Parser.py into an Atom object.">getAtomObject</a>()
<a name="l00071"></a>00071         <span class="keywordflow">return</span> self.<a class="code" href="classp__engine_1_1Pengine.html#a01e3a242f2a577a907b9b3c42684ee9f">persistent_list</a>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <span class="comment">## Translates the atom tuple received from Parser.py into an Atom object</span>
<a name="l00074"></a>00074     <span class="comment">#  @param self</span>
<a name="l00075"></a>00075     <span class="comment">#  @returns The newly created Atom object</span>
<a name="l00076"></a><a class="code" href="classp__engine_1_1Pengine.html#ac27626387a7c90d1bc407e28eceac7d3">00076</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#ac27626387a7c90d1bc407e28eceac7d3" title="Translates the atom tuple received from Parser.py into an Atom object.">getAtomObject</a>(self):
<a name="l00077"></a>00077         temp = self.<a class="code" href="classp__engine_1_1Pengine.html#a08efa7e34e28a632288d5002758b79be">parser</a>.get_atom()
<a name="l00078"></a>00078         a = self.<a class="code" href="classp__engine_1_1Pengine_1_1Atom.html">Atom</a>(temp[1],temp[2],temp[3],temp[0])
<a name="l00079"></a>00079         <span class="keywordflow">return</span> a
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">## Returns the smallest unused atom id or the id of the least recently seen atom which is now paged out of memory</span>
<a name="l00082"></a>00082     <span class="comment">#  @param self</span>
<a name="l00083"></a>00083     <span class="comment">#  @returns The id of the new Atom object in need of an ID</span>
<a name="l00084"></a><a class="code" href="classp__engine_1_1Pengine.html#a95b5a517f112462606ef90879e6413c8">00084</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#a95b5a517f112462606ef90879e6413c8" title="Returns the smallest unused atom id or the id of the least recently seen atom which is now paged out ...">getID</a>(self):
<a name="l00085"></a>00085         id_list = self.<a class="code" href="classp__engine_1_1Pengine.html#aa534599861376f871c1e608720d925a9">id_list</a>
<a name="l00086"></a>00086         <span class="keywordflow">if</span> len(id_list) &lt; self.<a class="code" href="classp__engine_1_1Pengine.html#a73a2bd7bd6c4098929c734df639dd4a2">max_ids</a>:
<a name="l00087"></a>00087             id_list.insert(0, len(id_list))
<a name="l00088"></a>00088             self.<a class="code" href="classp__engine_1_1Pengine.html#a4166dc5955cdfc2bdda64cd5937401a7">bitmaps</a>[len(id_list) - 1] = [0] * self.<a class="code" href="classp__engine_1_1Pengine.html#ad1f1d6652c5302615212355d55ab7797">max_frame_size</a>
<a name="l00089"></a>00089             <span class="keywordflow">return</span> len(id_list) - 1
<a name="l00090"></a>00090         <span class="keywordflow">else</span>:
<a name="l00091"></a>00091             old_id = id_list[-1]
<a name="l00092"></a>00092             self.<a class="code" href="classp__engine_1_1Pengine.html#a4166dc5955cdfc2bdda64cd5937401a7">bitmaps</a>[old_id] = [0] * self.<a class="code" href="classp__engine_1_1Pengine.html#ad1f1d6652c5302615212355d55ab7797">max_frame_size</a>
<a name="l00093"></a>00093             id_list.pop()
<a name="l00094"></a>00094             id_list.insert(0, old_id)
<a name="l00095"></a>00095             <span class="keywordflow">return</span> old_id
<a name="l00096"></a>00096             
<a name="l00097"></a>00097     <span class="comment">## Updates the atom&#39;s bitmap to reflect a sighting</span>
<a name="l00098"></a>00098     <span class="comment">#  during the current window.</span>
<a name="l00099"></a>00099     <span class="comment">#  @param atom The atom who&#39;s bitmap is to be updated.</span>
<a name="l00100"></a><a class="code" href="classp__engine_1_1Pengine.html#a2533c9acb91e279ca639b0791b43e060">00100</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#a2533c9acb91e279ca639b0791b43e060" title="Updates the atom&amp;#39;s bitmap to reflect a sighting during the current window.">updateBitmap</a>(self, atom):
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         self.<a class="code" href="classp__engine_1_1Pengine.html#a4166dc5955cdfc2bdda64cd5937401a7">bitmaps</a>[atom.id][-1] = 1
<a name="l00103"></a>00103         self.<a class="code" href="classp__engine_1_1Pengine.html#a320a9dcb9c7deb6bc2d7d8031e66b09f" title="Determines whether an atom is persistent based on its maximum ratio of windows seen to frame size com...">persistence</a>(atom)
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="comment">## Determines whether an atom is persistent based on its maximum ratio of windows seen</span>
<a name="l00106"></a>00106     <span class="comment">#  to frame size compared to a predetermined threshold and, if so, adds the atom to the</span>
<a name="l00107"></a>00107     <span class="comment">#  persistent_atom list</span>
<a name="l00108"></a>00108     <span class="comment">#  @param self</span>
<a name="l00109"></a>00109     <span class="comment">#  @param atom The atom being checked for persistence</span>
<a name="l00110"></a><a class="code" href="classp__engine_1_1Pengine.html#a320a9dcb9c7deb6bc2d7d8031e66b09f">00110</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#a320a9dcb9c7deb6bc2d7d8031e66b09f" title="Determines whether an atom is persistent based on its maximum ratio of windows seen to frame size com...">persistence</a>(self, atom):
<a name="l00111"></a>00111         <span class="keywordflow">if</span> <span class="keywordflow">not</span> atom <span class="keywordflow">in</span> self.<a class="code" href="classp__engine_1_1Pengine.html#a01e3a242f2a577a907b9b3c42684ee9f">persistent_list</a>:
<a name="l00112"></a>00112             temp = []
<a name="l00113"></a>00113             <span class="keywordflow">for</span> s <span class="keywordflow">in</span> self.<a class="code" href="classp__engine_1_1Pengine.html#a58b56e48011a894ec0fdb49bf4041f98">frame_sizes</a>:
<a name="l00114"></a>00114                 temp.append(sum(self.<a class="code" href="classp__engine_1_1Pengine.html#a4166dc5955cdfc2bdda64cd5937401a7">bitmaps</a>[atom.id][-s:self.<a class="code" href="classp__engine_1_1Pengine.html#ad1f1d6652c5302615212355d55ab7797">max_frame_size</a>])/s)
<a name="l00115"></a>00115             <span class="keywordflow">if</span>(max(temp) &gt; self.<a class="code" href="classp__engine_1_1Pengine.html#a39eda9d895a243ded1cf39285a6e916b">p_star</a>):
<a name="l00116"></a>00116                 self.<a class="code" href="classp__engine_1_1Pengine.html#a01e3a242f2a577a907b9b3c42684ee9f">persistent_list</a>.append(atom)
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="comment">## Removes all windows no longer in frame and adds new windows for latest part of frame.</span>
<a name="l00119"></a>00119     <span class="comment">#  @param self</span>
<a name="l00120"></a><a class="code" href="classp__engine_1_1Pengine.html#aae30c615b50a50d2b4575c8e3bd1c307">00120</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#aae30c615b50a50d2b4575c8e3bd1c307" title="Removes all windows no longer in frame and adds new windows for latest part of frame.">cleanBitmap</a>(self):
<a name="l00121"></a>00121         <span class="keywordflow">for</span> k,v <span class="keywordflow">in</span> self.<a class="code" href="classp__engine_1_1Pengine.html#a4166dc5955cdfc2bdda64cd5937401a7">bitmaps</a>.iteritems():
<a name="l00122"></a>00122             v.pop(0)
<a name="l00123"></a>00123             v.append(0)
<a name="l00124"></a>00124         
<a name="l00125"></a>00125     <span class="comment">## Determines whether the current atom already exists in bard&#39;s data</span>
<a name="l00126"></a>00126     <span class="comment">#  structures and if it does it updates its last_timestamps and returns it</span>
<a name="l00127"></a>00127     <span class="comment">#  @param a The atom that is being checked</span>
<a name="l00128"></a>00128     <span class="comment">#  @return existing The identical atom that already exists (if there is one)</span>
<a name="l00129"></a><a class="code" href="classp__engine_1_1Pengine.html#a794d77f201d3404d5c4d8d9eabf34fed">00129</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#a794d77f201d3404d5c4d8d9eabf34fed" title="Determines whether the current atom already exists in bard&amp;#39;s data structures and if it does it up...">atomExists</a>(self,a):
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         <span class="keywordflow">for</span> b <span class="keywordflow">in</span> self.<a class="code" href="classp__engine_1_1Pengine.html#a9d73408ab4c3b00739ea61f69ae828cf">atom_list</a>:
<a name="l00132"></a>00132             <span class="keywordflow">if</span> compareAtoms(a,b):
<a name="l00133"></a>00133                 b.last_timestamp = a.last_timestamp
<a name="l00134"></a>00134                 <span class="comment">#brings this atom to the front of the id_lists</span>
<a name="l00135"></a>00135                 self.<a class="code" href="classp__engine_1_1Pengine.html#aa534599861376f871c1e608720d925a9">id_list</a>.remove(b.id)
<a name="l00136"></a>00136                 self.<a class="code" href="classp__engine_1_1Pengine.html#aa534599861376f871c1e608720d925a9">id_list</a>.insert(0, b.id)
<a name="l00137"></a>00137                 <span class="keywordflow">return</span> b
<a name="l00138"></a>00138         <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00139"></a>00139         
<a name="l00140"></a>00140     <span class="comment">## Adds a premade atom to the atom_list. If it already exists in the list, do nothing</span>
<a name="l00141"></a>00141     <span class="comment">#  @param a The atom that is being added</span>
<a name="l00142"></a>00142     <span class="comment">#  @return (1) if new atom and added, (0) if no action was taken        </span>
<a name="l00143"></a><a class="code" href="classp__engine_1_1Pengine.html#a501fb9bba5a38eb9eed3d2c66d3e1a8d">00143</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#a501fb9bba5a38eb9eed3d2c66d3e1a8d" title="Adds a premade atom to the atom_list.">addAtom</a>(self,a):
<a name="l00144"></a>00144 
<a name="l00145"></a>00145         <span class="keywordflow">if</span> self.<a class="code" href="classp__engine_1_1Pengine.html#a794d77f201d3404d5c4d8d9eabf34fed" title="Determines whether the current atom already exists in bard&amp;#39;s data structures and if it does it up...">atomExists</a>(a) == <span class="keywordtype">None</span>:
<a name="l00146"></a>00146             self.<a class="code" href="classp__engine_1_1Pengine.html#a9d73408ab4c3b00739ea61f69ae828cf">atom_list</a>.append(a)
<a name="l00147"></a>00147             a.id = self.<a class="code" href="classp__engine_1_1Pengine.html#a95b5a517f112462606ef90879e6413c8" title="Returns the smallest unused atom id or the id of the least recently seen atom which is now paged out ...">getID</a>()
<a name="l00148"></a>00148             <span class="keywordflow">return</span> 1
<a name="l00149"></a>00149         <span class="keywordflow">return</span> 0
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     <span class="comment">## Updates local time-keeping variables based on latest atom timestamp.</span>
<a name="l00152"></a>00152     <span class="comment">#  @param a The atom to use</span>
<a name="l00153"></a>00153     <span class="comment">#  @return Was the time updated?</span>
<a name="l00154"></a><a class="code" href="classp__engine_1_1Pengine.html#ae4154c89c64df490a1a527c70500b83d">00154</a>     <span class="keyword">def </span><a class="code" href="classp__engine_1_1Pengine.html#ae4154c89c64df490a1a527c70500b83d" title="Updates local time-keeping variables based on latest atom timestamp.">timeCheck</a>(self,a):
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         t_0,t_1 = self.<a class="code" href="classp__engine_1_1Pengine.html#ae4f9218807b24d4e2afb3122dab4b981">t_0</a>,self.<a class="code" href="classp__engine_1_1Pengine.html#a71ed14eb65b5fb448e9289cc9ad86cb7">t_1</a>
<a name="l00157"></a>00157         a_time = int(a.last_timestamp)
<a name="l00158"></a>00158         <span class="keywordflow">if</span> t_0 &gt; t_1: <span class="comment"># Corner case when entire timestamp is to be reset</span>
<a name="l00159"></a>00159             t_0_tmp = timeIncrement(t_0)
<a name="l00160"></a>00160             t_1_tmp = timeIncrement(t_1)
<a name="l00161"></a>00161             a_time_tmp = timeIncrement(a_time)
<a name="l00162"></a>00162             <span class="keywordflow">if</span> a_time_tmp &gt; t_1_tmp:
<a name="l00163"></a>00163                 self.<a class="code" href="classp__engine_1_1Pengine.html#ae4f9218807b24d4e2afb3122dab4b981">t_0</a> = timeIncrement(t_0)
<a name="l00164"></a>00164                 self.<a class="code" href="classp__engine_1_1Pengine.html#a71ed14eb65b5fb448e9289cc9ad86cb7">t_1</a> = timeIncrement(t_1)
<a name="l00165"></a>00165                 <span class="keywordflow">return</span> 1<span class="comment"># + self.timeCheck(a)</span>
<a name="l00166"></a>00166         <span class="keywordflow">elif</span> (a_time &lt; t_1 <span class="keywordflow">and</span> a_time &lt; t_0) <span class="keywordflow">or</span> a_time &gt; t_1:
<a name="l00167"></a>00167             self.<a class="code" href="classp__engine_1_1Pengine.html#ae4f9218807b24d4e2afb3122dab4b981">t_0</a> = timeIncrement(t_0)
<a name="l00168"></a>00168             self.<a class="code" href="classp__engine_1_1Pengine.html#a71ed14eb65b5fb448e9289cc9ad86cb7">t_1</a> = timeIncrement(t_1)
<a name="l00169"></a>00169             <span class="keywordflow">return</span> 1<span class="comment"># + self.timeCheck(a)</span>
<a name="l00170"></a>00170         <span class="keywordflow">return</span> 0
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 <span class="comment">## Increments global time based on certain rules such as wrap around for days.</span>
<a name="l00173"></a>00173 <span class="comment">#  @param time The time to increment</span>
<a name="l00174"></a>00174 <span class="comment">#  @param amt By how much to increment. Default is 1hr= 00 01 0000</span>
<a name="l00175"></a>00175 <span class="comment">#  @return time The incremented time. </span>
<a name="l00176"></a><a class="code" href="namespacep__engine.html#ae8d76401c0c0ac214ac97ea046c52d14">00176</a> <span class="keyword">def </span><a class="code" href="namespacep__engine.html#ae8d76401c0c0ac214ac97ea046c52d14" title="Increments global time based on certain rules such as wrap around for days.">timeIncrement</a>(time, amt=Pengine.window_size):
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     mmss = time % 10000
<a name="l00179"></a>00179     hh = time/10000 % 100
<a name="l00180"></a>00180     hh += amt/10000 % 100
<a name="l00181"></a>00181     <span class="keywordflow">if</span> mmss == 0:
<a name="l00182"></a>00182         hh = hh % 25
<a name="l00183"></a>00183     <span class="keywordflow">else</span>:
<a name="l00184"></a>00184         hh = hh % 24
<a name="l00185"></a>00185     time_u = hh*(10000) + mmss
<a name="l00186"></a>00186     <span class="keywordflow">return</span> time_u
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">## Compare two atoms objects to see if they identify the same actual</span>
<a name="l00190"></a>00190 <span class="comment">#  atom based on dest_ip, dest_port and protocol</span>
<a name="l00191"></a>00191 <span class="comment">#  @param a The first atom being compared</span>
<a name="l00192"></a>00192 <span class="comment">#  @param b The second atom being compared</span>
<a name="l00193"></a>00193 <span class="comment">#  @returns Boolean of whether the atoms are identical (1) or not (0)</span>
<a name="l00194"></a><a class="code" href="namespacep__engine.html#aca0f28502df682a41b7bb1f91f1360a0">00194</a> <span class="keyword">def </span><a class="code" href="namespacep__engine.html#aca0f28502df682a41b7bb1f91f1360a0" title="Compare two atoms objects to see if they identify the same actual atom based on dest_ip, dest_port and protocol.">compareAtoms</a>(a,b):
<a name="l00195"></a>00195     <span class="keywordflow">if</span>(a.dest_ip != b.dest_ip):
<a name="l00196"></a>00196         <span class="keywordflow">return</span> 0
<a name="l00197"></a>00197     <span class="keywordflow">elif</span> (a.dest_port != b.dest_port):
<a name="l00198"></a>00198         <span class="keywordflow">return</span> 0
<a name="l00199"></a>00199     <span class="keywordflow">elif</span> (a.protocol != b.protocol):
<a name="l00200"></a>00200         <span class="keywordflow">return</span> 0
<a name="l00201"></a>00201     <span class="keywordflow">return</span> 1
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sat Dec 4 2010 18:19:49 for BARD by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
